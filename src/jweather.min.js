!function(a,b,c,d){function h(b,c){this.element=b,this.settings=a.extend({},f,c),this.settings.forecast=Math.min(this.settings.forecast,5),this._name=e,this.once=!1,this.init()}function i(a,b){var c={},d={0:"900",1:"weather-icon-windy-rain",2:"weather-icon-windy-rain2",3:"weather-icon-clouds-flash",4:"weather-icon-cloud-flash-alt",5:"weather-icon-snow",6:"weather-icon-rain",7:"weather-icon-rain",8:"weather-icon-drizzle",9:"weather-icon-drizzle",10:"weather-icon-rain",11:"weather-icon-rain",12:"weather-icon-rain",13:"weather-icon-snow-heavy",14:"weather-icon-snow",15:"weather-icon-snow",16:"weather-icon-snow-heavy",17:"weather-icon-hail",18:"weather-icon-rain",19:"weather-icon-mist",20:"weather-icon-fog-sun",21:"weather-icon-fog-cloud",22:"weather-icon-fog",23:"weather-icon-wind",24:"weather-icon-windy",25:"weather-icon-snowflake",26:"weather-icon-clouds",27:"weather-icon-clouds",28:"weather-icon-clouds",29:"weather-icon-cloud-moon",30:"weather-icon-cloud-sun",31:"weather-icon-moon",32:"weather-icon-sun",33:"weather-icon-moon",34:"weather-icon-sun",35:"weather-icon-hail",36:"weather-icon-temperature",37:"weather-icon-windy-rain",38:"weather-icon-windy-rain",39:"weather-icon-windy-rain",40:"weather-icon-rain",41:"weather-icon-snow-heavy",42:"weather-icon-snow-alt",43:"weather-icon-snow-heavy",44:"weather-icon-cloud",45:"weather-icon-clouds-flash",46:"weather-icon-snow-heavy",47:"weather-icon-cloud-flash-alt",3200:"weather-icon-na"};a=a.query.results.channel,c.location=a.location.city+", "+a.location.country,c.city=a.location.city,c.today={},c.today.temp={},c.today.temp.now=Math.round(a.item.condition.temp),c.today.temp.min=Math.round(a.item.forecast[0].low),c.today.temp.max=Math.round(a.item.forecast[0].high),c.today.desc=a.item.condition.text.capitalize(),c.today.code=d[a.item.condition.code],c.today.wind={},c.today.wind.speed=a.wind.speed,c.today.wind.deg=a.wind.direction,c.today.humidity=a.atmosphere.humidity,c.today.pressure=a.atmosphere.pressure,c.today.sunrise=a.astronomy.sunrise.toUpperCase(),c.today.sunset=a.astronomy.sunset.toUpperCase(),c.today.day=j(new Date),c.forecast=[];for(var e=0;e<=b.forecast;e++){var f={};f.day=j(new Date(a.item.forecast[e].date)),f.code=d[a.item.forecast[e].code],f.desc=a.item.forecast[e].text.capitalize(),f.temp={max:Math.round(a.item.forecast[e].high),min:Math.round(a.item.forecast[e].low)},c.forecast.push(f)}return c}function j(a){return["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"][a.getDay()]}function l(a,b,c){var d=b;return d>=0&&d<=11.25||d>348.75&&d<=360?d="N":d>11.25&&d<=33.75?d="NNE":d>33.75&&d<=56.25?d="NE":d>56.25&&d<=78.75?d="ENE":d>78.75&&d<=101.25?d="E":d>101.25&&d<=123.75?d="ESE":d>123.75&&d<=146.25?d="SE":d>146.25&&d<=168.75?d="SSE":d>168.75&&d<=191.25?d="S":d>191.25&&d<=213.75?d="SSW":d>213.75&&d<=236.25?d="SW":d>236.25&&d<=258.75?d="WSW":d>258.75&&d<=281.25?d="W":d>281.25&&d<=303.75?d="WNW":d>303.75&&d<=326.25?d="NW":d>326.25&&d<=348.75&&(d="NNW"),a+" "+("metric"==c?"km/h":"mph")+" "+d}var e="jweather",f={location:"Waterloo, ON",forecast:5,view:"full",render:!0},g={yahoo:["https://query.yahooapis.com/v1/public/yql"]};a.extend(h.prototype,{init:function(){this.settings.render&&this.fetchWeather().then(this.render,this.error),this.once=!0},fetchWeather:function(){var b=this,c=new a.Deferred,d=[],e=this.settings.location,f="metric"==this.settings.units?"c":"f",h={};h.q="select * from weather.forecast where woeid in (select woeid from geo.places(1) where text='"+e+"') AND u='"+f+"'",h.env="store://datatables.org/alltableswithkeys",h.format="json",d.push(h);for(var j=[],k=0;k<g.yahoo.length;k++)j.push(a.get(g.yahoo[k],d[k]));return a.when.apply(this,j).done(function(){var d=Array.prototype.slice.call(arguments);if(d=j.length>1?d.map(function(a){return a[0]}):d[0],0==d.query.count||"Yahoo! Weather Error"==d.query.results.channel.description)console.log("Error interacting with the yahoo api see error object below for details:"),console.log(d),c.reject(d,b);else{var e=i(d,b.settings);b._weather=e,a.data(b.element,"weather",e),c.resolve(e,b)}}).fail(function(a){console.log("fail"),c.reject(a,b)}),c},error:function(b,c){c||(c=this),b=b.query.results?"Error: "+b.query.results.channel.item.title+". See console log for details.":"Error: no results. See console log for details.";var d=a("<div/>",{class:"weather-widget "+c.settings.view});return a("<h2/>").text("Error").appendTo(d),a("<p/>").text(b).appendTo(d),a(c.element).html(d),a(c.element)},render:function(b,c){c||(c=this,b=this._weather);var d="metric"==c.settings.units?"&#176;C":"&#176;F",e=a("<div/>",{class:"weather-widget "+c.settings.view}),f=a("<div/>",{class:"pst-block"}).appendTo(e),g=a("<div/>",{class:"pst-block-head"}).appendTo(f),h=a("<div/>",{class:"pst-block-main"}).appendTo(f),i=a("<h2/>",{class:"title-4"}).appendTo(g),j='<strong><i class="li_location"></i> '+b.location+"</strong>";if(i.append(j),"forecast"!=c.settings.view){var k=a("<div/>",{class:"weather-block"}),m=a("<div/>",{class:"temperature"});a("<i/>",{class:b.today.code}).appendTo(m),a("<span/>",{class:"degrees-1"}).html(b.today.temp.now+"<sup>"+d+"</sup>").appendTo(m),a("<div/>",{class:"day"}).text(b.today.day).appendTo(m),m.appendTo(k),k.appendTo(h);a("<hr/>",{class:"pst-block-hr"}).appendTo(h)}if("simple"!=c.settings.view){var o=a("<ul/>");if(a("<li/>").html("Humedad "+b.today.humidity+"%").appendTo(o),a("<li/>").html("Viento "+l(b.today.wind.speed,b.today.wind.deg,c.settings.units)).appendTo(o),a("<li/>").html("H "+b.today.temp.max+"<sup>"+d+"</sup> L "+b.today.temp.min+"<sup>"+d+"</sup>").appendTo(o),o.appendTo(k),"today"!=c.settings.view||"forecast"==c.settings.view){for(var p=a("<div/>",{class:"weather-days"}),q=a("<ul/>",{class:"weather-days-list"}),r="forecast"==c.settings.view?0:1,s=r;s<b.forecast.length;s++){var t=a("<li/>").appendTo(q);a("<span/>",{class:"degrees-2"}).html(b.forecast[s].temp.max+"<i class='degrees-ic-2'></i>").appendTo(t),a("<div/>",{class:"day"}).html(b.forecast[s].day).appendTo(t)}q.appendTo(p),p.appendTo(h)}}return a(c.element).html(e),a(c.element)}}),a.fn[e]=function(b,c){return a.isFunction(h.prototype[b])?this.data("plugin_"+e)[b](c):this.each(function(){if(!a.data(this,"plugin_"+e)){var c=new h(this,b);return a.data(this,"plugin_"+e,c)}})},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}(jQuery,window,document);